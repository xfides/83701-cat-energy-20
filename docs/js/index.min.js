"use strict";var _createClass=function(){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var r={RAF:requestAnimationFrame.bind(window),maxMobileWidth:768,isMobileView:function(e){var t=0<arguments.length&&void 0!==e?e:r.maxMobileWidth;return document.documentElement.clientWidth<t},throttle:function(e,t){var i=!1,s=void 0,n=void 0;function r(){if(i)return s=arguments,void(n=this);e.apply(this,arguments),i=!0,setTimeout(function(){i=!1,s&&(r.apply(n,s),s=n=null)},t)}return r}},e=(_createClass(a,[{key:"init",value:function(){this._readyToInit&&(this._setupSliderTypeView(),this._calcSliderElemsInfo(),this._placeSliderElems(),this._setupEventListeners())}},{key:"_reload",value:function(){r.isMobileView()&&this._currentTypeView===a.config.mobile.TYPE_VIEW||!r.isMobileView()&&this._currentTypeView===a.config.desktop.TYPE_VIEW||(this._setupSliderTypeView(),this._calcSliderElemsInfo(),this._placeSliderElems(null))}},{key:"_setupSliderTypeView",value:function(){this._currentTypeView=r.isMobileView()?a.config.mobile.TYPE_VIEW:a.config.desktop.TYPE_VIEW}},{key:"_areExistDomSliderElems",value:function(e){return this._domNodes={slider:e,slides:e.querySelectorAll("."+a.classNames.SLIDE),btnPrev:e.querySelector("."+a.classNames.BTN_PREV),btnNext:e.querySelector("."+a.classNames.BTN_NEXT),barOuter:e.querySelector("."+a.classNames.BAR_OUTER),barInner:e.querySelector("."+a.classNames.BAR_INNER)},2===this._domNodes.slides.length&&this._domNodes.btnPrev&&this._domNodes.btnNext&&this._domNodes.barOuter&&this._domNodes.barInner}},{key:"_getInitialSeparatorPos",value:function(){var e=a.config;return this._currentTypeView===e.desktop.TYPE_VIEW?e.desktop.SEPARATOR_START_POS:this._currentTypeView===e.mobile.TYPE_VIEW?e.mobile.SEPARATOR_START_POS:e.SEPARATOR_POS_MAX}},{key:"_placeSliderElems",value:function(e){var t=0<arguments.length&&void 0!==e?e:null,i=null===t?this._getInitialSeparatorPos():t;this._placeSlidesBySeparator(i),this._placeRollBySeparator(i)}},{key:"_placeSlidesBySeparator",value:function(e){this._domNodes.slides[0].style.width=e+"%",this._domNodes.slides[1].style.width=a.config.SEPARATOR_POS_MAX-e+"%"}},{key:"_placeRollBySeparator",value:function(e){var t=a.config,i=this._barProps.width-this._rollProps.width,s=parseInt((t.SEPARATOR_POS_MAX-e)*i/t.SEPARATOR_POS_MAX);this._domNodes.barInner.style.left=s+"px"}},{key:"_calcSliderElemsInfo",value:function(){this._barProps=this._getPropsOfBar(),this._rollProps=this._getPropsOfRoll()}},{key:"_getPropsOfBar",value:function(){var e=getComputedStyle(this._domNodes.barOuter),t={widthWithPadding:this._domNodes.barOuter.clientWidth,paddingLeftWidth:parseFloat(e.paddingLeft),paddingRightWidth:parseFloat(e.paddingRight)};return t.width=t.widthWithPadding-t.paddingLeftWidth-t.paddingRightWidth,t}},{key:"_getPropsOfRoll",value:function(){var e=getComputedStyle(this._domNodes.barInner),t={widthWithPadding:this._domNodes.barInner.clientWidth,borderLeftWidth:parseFloat(e.borderLeft),borderRightWidth:parseFloat(e.borderRight)};return t.width=t.widthWithPadding+t.borderLeftWidth+t.borderRightWidth,t}},{key:"_setupEventListeners",value:function(){this._domNodes.btnPrev.addEventListener("click",this._handleBtnPrev),this._domNodes.btnNext.addEventListener("click",this._handleBtnNext),window.addEventListener("resize",this._reload),this._handleBtnRoll()}},{key:"_handleBtnPrev",value:function(){var e=this;r.RAF(function(){e._placeSliderElems(a.config.SEPARATOR_POS_MAX)})}},{key:"_handleBtnNext",value:function(){var e=this;r.RAF(function(){e._placeSliderElems(a.config.SEPARATOR_POS_MIN)})}},{key:"_handleBtnRoll",value:function(){var t=this,e=this._domNodes.barInner;this._disableBrowserDragging(e),e.addEventListener("mousedown",function(e){t._beforeDrag={rollPosLeft:parseInt(t._domNodes.barInner.style.left),rollMaxLeft:t._barProps.width-t._rollProps.width,rollMinLeft:0,firstMouseCoordX:e.pageX},document.addEventListener("mousemove",t._dragRollHandler),document.addEventListener("mouseup",t._removeDragRollHandler)})}},{key:"_dragRollHandler",value:function(e){var t=e.pageX-this._beforeDrag.firstMouseCoordX;this._dragRollEdgeCasesControl(t)||this._dragRollManualControl(t)}},{key:"_dragRollEdgeCasesControl",value:function(e){var t=this,i=a.config;if(this._beforeDrag.rollPosLeft===this._beforeDrag.rollMaxLeft&&0<=e||this._beforeDrag.rollPosLeft===this._beforeDrag.rollMinLeft&&e<=0)return!0;var s=this._beforeDrag.rollPosLeft+e;return s>this._beforeDrag.rollMaxLeft?(r.RAF(function(){t._placeSliderElems(i.SEPARATOR_POS_MIN)}),!0):s<this._beforeDrag.rollMinLeft&&(r.RAF(function(){t._placeSliderElems(i.SEPARATOR_POS_MAX)}),!0)}},{key:"_dragRollManualControl",value:function(e){var t=this,i=a.config,s=this._beforeDrag.rollPosLeft+e,n=parseInt(s/this._beforeDrag.rollMaxLeft*i.SEPARATOR_POS_MAX);r.RAF(function(){t._domNodes.barInner.style.left=s+"px",t._placeSlidesBySeparator(i.SEPARATOR_POS_MAX-n)})}},{key:"_removeDragRollHandler",value:function(){document.removeEventListener("mousemove",this._dragRollHandler),document.removeEventListener("mouseup",this._removeDragRollHandler)}},{key:"_disableBrowserDragging",value:function(e){e.addEventListener("dragstart",function(e){return e.preventDefault(),!1})}}]),a);function a(){_classCallCheck(this,a);var e=document.querySelector("."+a.classNames.SLIDER);this._handleBtnPrev=this._handleBtnPrev.bind(this),this._handleBtnNext=this._handleBtnNext.bind(this),this._handleBtnRoll=this._handleBtnRoll.bind(this),this._removeDragRollHandler=this._removeDragRollHandler.bind(this),this._dragRollHandler=r.throttle(this._dragRollHandler.bind(this),a.config.THROTTLE_TIME_DRAG),this._reload=r.throttle(this._reload.bind(this),a.config.THROTTLE_TIME_RELOAD),this._readyToInit=e&&this._areExistDomSliderElems(e)}e.classNames={SLIDER:"slider",SLIDE:"slider__slide",BTN_PREV:"slider__btn--prevJS",BTN_NEXT:"slider__btn--nextJS",BAR_OUTER:"slider__bar",BAR_INNER:"slider__roll"},e.config={THROTTLE_TIME_RELOAD:500,THROTTLE_TIME_DRAG:33,SEPARATOR_POS_MAX:100,SEPARATOR_POS_MIN:0,mobile:{SEPARATOR_START_POS:100,TYPE_VIEW:"mobile"},desktop:{SEPARATOR_START_POS:50,TYPE_VIEW:"desktop"}};var t=(_createClass(i,[{key:"init",value:function(){this._readyToInit&&(this._domSpinBtn.classList.remove(i.classNames.SPIN_BTN_NO_JS),this._domSpinBtn.addEventListener("click",this._handleSpinBtn),window.addEventListener("resize",this._reload),r.isMobileView()&&this._domNav.classList.add(i.classNames.NAV_CLOSED))}},{key:"_reload",value:function(){r.isMobileView()?(this._domNav.classList.add(i.classNames.NAV_CLOSED),this._domSpinBtn.classList.remove(i.classNames.SPIN_BTN_CLOSED_NAV)):this._domNav.classList.remove(i.classNames.NAV_CLOSED)}},{key:"_handleSpinBtn",value:function(){this._domNav.classList.toggle(i.classNames.NAV_CLOSED),this._domSpinBtn.classList.toggle(i.classNames.SPIN_BTN_CLOSED_NAV)}}]),i);function i(){_classCallCheck(this,i),this._domNav=document.querySelector("."+i.classNames.NAV),this._domSpinBtn=document.querySelector("."+i.classNames.SPIN_BTN),this._readyToInit=this._domNav&&this._domSpinBtn,this._handleSpinBtn=this._handleSpinBtn.bind(this),this._reload=r.throttle(this._reload.bind(this),i.config.THROTTLE_TIME)}t.classNames={NAV:"header__wrapNav",NAV_CLOSED:"header__wrapNav--closedJS",SPIN_BTN:"hamburger",SPIN_BTN_CLOSED_NAV:"hamburger--pressedJS",SPIN_BTN_NO_JS:"hamburger--hiddenWithNoJS"},t.config={THROTTLE_TIME:500};var s=(_createClass(n,[{key:"init",value:function(){this._readyToInit&&(this._setupMapTypeView(),this._createAndLoadAPIScript(),window.addEventListener("resize",this._reload))}},{key:"_reload",value:function(){!window.ymaps||this._currentTypeView===n.config.mobile.TYPE_VIEW&&r.isMobileView()||this._currentTypeView===n.config.tablet.TYPE_VIEW&&!r.isMobileView()&&r.isMobileView(n.config.tablet.MAX_VIEW_WIDTH)||this._currentTypeView===n.config.desktop.TYPE_VIEW&&!r.isMobileView(n.config.tablet.MAX_VIEW_WIDTH)||(this._setupMapTypeView(),this._placeMark&&this._myMap.geoObjects.remove(this._placeMark),this._placeMark=this._createPlaceMark(),this._myMap.geoObjects.add(this._placeMark),this._myMap.setCenter(n.config[this._currentTypeView].CENTER_COORDS,n.config[this._currentTypeView].ZOOM))}},{key:"_setupMapTypeView",value:function(){r.isMobileView()?this._currentTypeView=n.config.mobile.TYPE_VIEW:r.isMobileView()||!r.isMobileView(n.config.tablet.MAX_VIEW_WIDTH)?this._currentTypeView=n.config.desktop.TYPE_VIEW:this._currentTypeView=n.config.tablet.TYPE_VIEW}},{key:"_createAndLoadAPIScript",value:function(){var e=this,t=document.createElement("script");t.src=n.config.SRC_YANDEX_MAP_API,t.addEventListener("load",function(){ymaps.ready(e._renderMap)}),document.body.append(t)}},{key:"_renderMap",value:function(){this._domMap.innerHTML="";var e=this._currentTypeView===n.config.mobile.TYPE_VIEW?n.config.mobile:this._currentTypeView===n.config.tablet.TYPE_VIEW?n.config.tablet:n.config.desktop;this._myMap=new ymaps.Map(n.config.ID,{center:e.CENTER_COORDS,zoom:e.ZOOM,controls:[]}),this._myMap.behaviors.disable("scrollZoom"),this._myMap.controls.add("zoomControl",{size:"auto",position:e.ZOOM_COORDS}),this._placeMark=this._createPlaceMark(),this._myMap.geoObjects.add(this._placeMark)}},{key:"_createPlaceMark",value:function(){var e=n.config[this._currentTypeView].placeMark;return new ymaps.Placemark(e.COORDS,{},{iconLayout:e.icon.LAYOUT,iconImageHref:e.icon.IMAGE_HREF,iconImageSize:e.icon.IMAGE_SIZE,iconImageOffset:e.icon.IMAGE_OFFSET})}}]),n);function n(){_classCallCheck(this,n),this._domMap=document.querySelector("#"+n.config.ID),this._readyToInit=!!this._domMap,this._renderMap=this._renderMap.bind(this),this._reload=r.throttle(this._reload.bind(this),n.config.THROTTLE_TIME_RELOAD)}s.config={ID:"map",SRC_YANDEX_MAP_API:"https://api-maps.yandex.ru/2.1/?lang=ru_RU",THROTTLE_TIME_RELOAD:500,mobile:{TYPE_VIEW:"mobile",CENTER_COORDS:[59.93857427,30.32311762],ZOOM:15,ZOOM_COORDS:{top:20,left:20},placeMark:{COORDS:[59.93852105,30.32322291],icon:{LAYOUT:"default#image",IMAGE_HREF:"img/map-pin.png",IMAGE_SIZE:[57,53],IMAGE_OFFSET:[-28,-53]}}},tablet:{TYPE_VIEW:"tablet",MAX_VIEW_WIDTH:1440,CENTER_COORDS:[59.93857427,30.32311762],ZOOM:15,ZOOM_COORDS:{top:20,left:20},placeMark:{COORDS:[59.93852105,30.32322291],icon:{LAYOUT:"default#image",IMAGE_HREF:"img/map-pin.png",IMAGE_SIZE:[113,106],IMAGE_OFFSET:[-52,-106]}}},desktop:{TYPE_VIEW:"desktop",CENTER_COORDS:[59.93836854,30.31903718],ZOOM:16,ZOOM_COORDS:{top:20,right:20},placeMark:{COORDS:[59.93852105,30.32322291],icon:{LAYOUT:"default#image",IMAGE_HREF:"img/map-pin.png",IMAGE_SIZE:[113,106],IMAGE_OFFSET:[-52,-106]}}}};var o=new e,l=new t;new s;o.init(),l.init()}();